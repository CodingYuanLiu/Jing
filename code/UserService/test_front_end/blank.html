<html>
    <header>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </header>
    <script>
        var a = new Vue({
            created: function() {
                s = window.location.href;
                code = s.slice(s.indexOf('=')+1);
                axios.get("http://localhost:8080/getuserinfo?code=" + code).then(resp => {
                    axios({
                        method: "post",
                        url: "http://localhost:8080/login",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8"
                        },
                        data: { access_token: resp.data },
                        params: { access_token: resp.data },
                        withCredentials: true,
                    }).then(response => {
                        window.alert("登录成功！");
                        window.location.href = '/login'
                    }).catch(error => {
                        window.alert("注册新账户！");
                        window.location.href = '/register?token=' + resp.data;
                    })
                })
            }
        })
    </script>
</html>